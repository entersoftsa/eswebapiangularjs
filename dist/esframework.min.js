(function(){"use strict";var e=angular.module("es.Core.Filters",[]);e.filter("esTrustHtml",["$sce",function(e){return function(r){return e.trustAsHtml(r)}}])})();(function(){"use strict";var e=angular.module("es.Services.Web",["ngStorage","ngSanitize"]);e.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__USERSITES__:"api/Login/Usersites",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__REGISTER_EXCEPTION__:"api/rpc/registerException/"});e.value("__WEBAPI_RT__",{url:""});function r(e,r){return e.indexOf(r,e.length-r.length)!==-1}function t(e,r){return e.toLowerCase().indexOf(r.toLowerCase())===0}e.provider("es.Services.WebApi",function(){var e="";var n="";var o="";var i={host:"",allowUnsecureConnection:false,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return i},getServerUrl:function(){return e},setSettings:function(s){var c="https://";var a="http://";i=s;if(i.host){i.host=i.host.trim();if(t(i.host,c)){i.host=i.host.slice(c.length).trim()}else if(t(i.host,a)){i.host=i.host.slice(a.length).trim()}if(i.host==""){throw"host for Entersoft WEB API Server is not specified"}if(!r(i.host,"/")){i.host+="/"}n=a+i.host;o=c+i.host;if(i.allowUnsecureConnection){e=n}else{e=o}}else{throw"host for Entersoft WEB API Server is not specified"}return this},$get:["$http","$log","$q","$rootScope","ESWEBAPI_URL","es.Services.Globals",function(r,t,s,c,a,u){return{getServerUrl:function(){return e},openSession:function(n){return r({method:"post",url:e+a.__LOGIN__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:n}}).success(function(e){u.sessionOpened(e,n)}).error(function(e){u.sessionClosed();t.error(e)})},logout:function(){u.sessionClosed();t.info("LOGOUT User")},registerException:function(r,n){if(!r){return}var o=angular.copy(r);try{o.__SubscriptionID=i.subscriptionId;o.__ServerUrl=e;o.__EDate=new Date;$.ajax({type:"POST",url:e.concat(a.__REGISTER_EXCEPTION__),contentType:"application/json",headers:{Authorization:u.getWebApiToken()},data:JSON.stringify({exceptionData:o,exceptionStore:n},null,"	")})}catch(s){t.warn("Error logging failed");t.error(s)}},fetchServerCapabilities:function(){var e=s.defer();r.get(n+a.__SERVER_CAPABILITIES__).success(function(r){e.resolve(r)}).error(function(){r.get(o+a.__SERVER_CAPABILITIES__).success(function(r){e.resolve(r)}).error(function(r,t,n,o){e.reject([r,t,n,o])})});return e.promise},fetchSimpleScrollerRootTable:function(t,n,o){var i=e.concat(a.__SCROLLERROOTTABLE__,t,"/",n);return r({method:"get",headers:{Authorization:u.getWebApiToken()},url:i,data:o})},fetchUserSites:function(t){return r({method:"post",url:e+a.__USERSITES__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:t}})},executeNewEntityAction:function(t,n,o){var i=e.concat(a.__ENTITYACTION__,t,"/",o);return r({method:"post",headers:{Authorization:u.getWebApiToken()},url:i,data:n})},executeEntityActionByCode:function(t,n,o,i){var s=e.concat(a.__ENTITYACTION__,t,"/",n,"/",i);return r({method:"post",headers:{Authorization:u.getWebApiToken()},url:s,data:o})},executeEntityActionByGID:function(t,n,o,i){var s=e.concat(a.__ENTITYBYGIDACTION__,t,"/",n,"/",i);return r({method:"post",headers:{Authorization:u.getWebApiToken()},url:s,data:o})},fetchPublicQuery:function(t,n,o){var i=e.concat(a.__PUBLICQUERY__,t,"/",n);return r({method:"get",headers:{Authorization:u.getWebApiToken()},url:i,data:o})},eSearch:function(t,n,o){var i=e.concat(a.__ELASTICSEARCH__,t);return r({method:n,headers:{Authorization:u.getWebApiToken()},url:i,data:o})}}}]}});e.factory("es.Services.ElasticSearch",["es.Services.WebApi",function(e){return{searchIndex:function(r,t){var n=r+"/_search";return e.eSearch(n,"post",t)},searchIndexAndDocument:function(r,t,n){var o=r+"/"+t+"/_search";return e.eSearch(o,"post",n)},searchFree:e.eSearch}}])})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.StackTrace",function(){return{print:printStackTrace}});e.provider("$log",function(){var e=[];var r=null;var t=null;var n=log4javascript.Level.ALL;var o=null;function i(){return log4javascript.getLogger("esLogger")}function s(e){a(new log4javascript.BrowserConsoleAppender);var r=angular.isDefined(e)&&e;if(r){a(new log4javascript.PopUpAppender)}}function c(e,t){if(!r){return}if(o&&e){o.setCustomField("userId",e.connectionModel.UserID);if(e.credentials){o.setCustomField("branchId",e.credentials.BranchID);o.setCustomField("langId",e.credentials.LangID)}}var n=r.getHeaders();if(n){var i;var s=-1;for(i=0;i<n.length;i++){if(n[i].name=="Authorization"){s=i;break}}if(s!=-1){n.splice(s,1)}}if(t&&t!=""){r.addHeader("Authorization",t)}}function a(r){if(e.indexOf(r)==-1){e.push(r);return true}return false}return{setLevel:function(e){n=e;if(t){t.setLevel(n)}},getLevel:function(){return n},getCurrentLevel:function(){if(t){return t.getEffectiveLevel()}else{return log4javascript.Level.OFF}},addAppender:a,addDefaultAppenders:s,addESWebApiAppender:function(e,t){var n=e+"api/rpc/registerException/";r=new log4javascript.AjaxAppender(n,false);r.setSendAllOnUnload(true);o=new log4javascript.JsonLayout;o.setCustomField("subscriptionId",t);r.setLayout(o);r.setWaitForResponse(true);r.setBatchSize(100);r.setTimed(true);r.setTimerInterval(6e4);r.addHeader("Content-Type","application/json");r.setRequestSuccessCallback(function(e){console.log("ES Logger, BATCH of logs upoloaded",e.responseURL,e.status)});r.setFailCallback(function(e){console.error("Failed to POST Logs to the server",e)});return a(r)},$get:["es.Services.Messaging",function(o){try{t=i();t.setLevel(n);if(e.length==0){s()}var a=0;for(a=0;a<e.length;a++){t.addAppender(e[a])}o.subscribe("AUTH_CHANGED",function(e,r){c(e,r)});t.sendAll=function(){try{if(r){r.sendAll()}}catch(e){}};console.info("ES Logger started");return t}catch(u){console.log("Error in starting entersoft logger",u);return $log}}]}});e.provider("$exceptionHandler",function(){var e={pushToServer:false,logServer:""};return{getSettings:function(){return e},setPushToServer:function(r){e.pushToServer=r},setLogServer:function(r){e.logServer=r},$get:["$log","$window","es.Services.StackTrace","$injector",function(r,t,n,o){function i(i,s){var c,a,u;try{c=i.toString();a=n.print({e:i});u={errorUrl:t.location.href,errorMessage:c,stackTrace:a,cause:s||""};r.error(JSON.stringify(u,null,"	"))}catch(l){console.log(arguments)}if(e.pushToServer){try{var f=o.get("es.Services.WebApi");f.registerException(u,e.logServer)}catch(l){r.warn("ES Error in registerException on store "+e.logServer);r.error(l)}}}return i}]}})})();(function(){"use strict";var e=angular.module("es.Services.Web");e.provider("es.Services.GA",function(){var e="";return{create:function(r,t,n){e=t;try{if(angular.isUndefined(r.ga)){console.error("Google Analytics is not loaded!!!");return}if(!e||e==""){console.error("Google Analytics UAT Key is not defined !!!");return}ga("create",e,n)}catch(o){console.error(o)}},getGAKey:function(){return e},$get:["$log","$window",function(e,r){return r.ga}]}})})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.Messaging",function(){var e={};function r(){if(!arguments||arguments.Length<1){throw"Publishing events requires at least one argument for topic id"}var r=arguments[0];var t=Array.prototype.slice.call(arguments,1);e[r]&&angular.forEach(e[r],function(e){try{e.apply(null,t)}catch(n){console.log("Error in messaging handler for topic ",r)}})}function t(r,t){if(!e[r]){e[r]=[]}e[r].push(t);return[r,t]}function n(r){var t=r[0];e[t]&&angular.forEach(e[t],function(n){if(this==r[1]){e[t].splice(n,1)}})}var o={publish:r,subscribe:t,unsubscribe:n};return o});e.factory("es.Services.Globals",["$sessionStorage","$log","es.Services.Messaging","es.Services.GA",function(e,r,t,n){function o(){if(!c.connectionModel){var n=e;var o=null;if(typeof n.__esrequest_sesssion!=="undefined"&&n.__esrequest_sesssion!==null){o=n.__esrequest_sesssion;c.connectionModel=o;t.publish("AUTH_CHANGED",c,s(o));r.info("RELOGIN User ",c.connectionModel.Name)}else{t.publish("AUTH_CHANGED",null,s(null));r.info("NO RELOGIN from stored state")}}return c.connectionModel}function i(r){c.connectionModel=r;if(!r){delete e.__esrequest_sesssion}else{e.__esrequest_sesssion=r}t.publish("AUTH_CHANGED",c,s(r))}function s(e){if(e){return"Bearer "+e.WebApiToken}return""}var c={hostUrl:"",credentials:null,connectionModel:null,getWebApiToken:function(){return s(o())},setModel:i,getModel:o};return{getWebApiToken:function(){return c.getWebApiToken()},getClientSession:function(){return c},sessionClosed:function(){c.setModel(null)},sessionOpened:function(e,t){try{c.setModel(e.Model);c.credentials=t;var o=0;for(o=0;o<12;o++){n("send","event","AUTH","LOGIN",e.Model.GID)}r.info("LOGIN User ",e.Model.Name)}catch(i){r.error(i);throw i}}}}]);e.run(["es.Services.Globals","es.Services.WebApi",function(e,r){var t=e.getClientSession();t.getModel();t.hostUrl=r.getServerUrl()}])})();