(function(){"use strict";var e=angular.module("es.Core.Filters",[]);e.filter("esTrustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}])})();(function(){"use strict";var e=angular.module("es.Services.Web",["ngStorage","ngSanitize"]);e.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__USERSITES__:"api/Login/Usersites",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__REGISTER_EXCEPTION__:"api/rpc/registerException/"});e.value("__WEBAPI_RT__",{url:""});function t(e,t){return e.indexOf(t,e.length-t.length)!==-1}function r(e,t){return e.toLowerCase().indexOf(t.toLowerCase())===0}e.provider("es.Services.WebApi",function(){var e="";var n="";var o="";var i={host:"",allowUnsecureConnection:false,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return i},getServerUrl:function(){return e},setSettings:function(s){var c="https://";var a="http://";i=s;if(i.host){i.host=i.host.trim();if(r(i.host,c)){i.host=i.host.slice(c.length).trim()}else if(r(i.host,a)){i.host=i.host.slice(a.length).trim()}if(i.host==""){throw"host for Entersoft WEB API Server is not specified"}if(!t(i.host,"/")){i.host+="/"}n=a+i.host;o=c+i.host;if(i.allowUnsecureConnection){e=n}else{e=o}}else{throw"host for Entersoft WEB API Server is not specified"}return this},$get:["$http","$log","$q","$rootScope","ESWEBAPI_URL","es.Services.Globals",function(t,r,s,c,a,u){return{getServerUrl:function(){return e},openSession:function(n){return t({method:"post",url:e+a.__LOGIN__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:n}}).success(function(e){u.sessionOpened(e)}).error(function(e){u.sessionClosed();r.error(e)})},logout:function(){u.sessionClosed();r.log.info("LOGOUT User")},registerException:function(t,n){if(!t){return}var o=angular.copy(t);try{o.__SubscriptionID=i.subscriptionId;o.__ServerUrl=e;o.__EDate=new Date;$.ajax({type:"POST",url:e.concat(a.__REGISTER_EXCEPTION__),contentType:"application/json",headers:{Authorization:u.getWebApiToken()},data:JSON.stringify({exceptionData:o,exceptionStore:n},null,"	")})}catch(s){r.warn("Error logging failed");r.log(s)}},fetchServerCapabilities:function(){var e=s.defer();t.get(n+a.__SERVER_CAPABILITIES__).success(function(t){e.resolve(t)}).error(function(){t.get(o+a.__SERVER_CAPABILITIES__).success(function(t){e.resolve(t)}).error(function(t,r,n,o){e.reject([t,r,n,o])})});return e.promise},fetchSimpleScrollerRootTable:function(r,n,o){var i=e.concat(a.__SCROLLERROOTTABLE__,r,"/",n);return t({method:"get",headers:{Authorization:u.getWebApiToken()},url:i,data:o})},fetchUserSites:function(r){return t({method:"post",url:e+a.__USERSITES__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:r}})},executeNewEntityAction:function(r,n,o){var i=e.concat(a.__ENTITYACTION__,r,"/",o);return t({method:"post",headers:{Authorization:u.getWebApiToken()},url:i,data:n})},executeEntityActionByCode:function(r,n,o,i){var s=e.concat(a.__ENTITYACTION__,r,"/",n,"/",i);return t({method:"post",headers:{Authorization:u.getWebApiToken()},url:s,data:o})},executeEntityActionByGID:function(r,n,o,i){var s=e.concat(a.__ENTITYBYGIDACTION__,r,"/",n,"/",i);return t({method:"post",headers:{Authorization:u.getWebApiToken()},url:s,data:o})},fetchPublicQuery:function(r,n,o){var i=e.concat(a.__PUBLICQUERY__,r,"/",n);return t({method:"get",headers:{Authorization:u.getWebApiToken()},url:i,data:o})},eSearch:function(r,n,o){var i=e.concat(a.__ELASTICSEARCH__,r);return t({method:n,headers:{Authorization:u.getWebApiToken()},url:i,data:o})}}}]}});e.factory("es.Services.ElasticSearch",["es.Services.WebApi",function(e){return{searchIndex:function(t,r){var n=t+"/_search";return e.eSearch(n,"post",r)},searchIndexAndDocument:function(t,r,n){var o=t+"/"+r+"/_search";return e.eSearch(o,"post",n)},searchFree:e.eSearch}}])})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.StackTrace",function(){return{print:printStackTrace}});e.provider("$log",function(){var e=[];var t=null;function r(){return log4javascript.getLogger("esLogger")}function n(){i(new log4javascript.BrowserConsoleAppender);i(new log4javascript.PopUpAppender)}function o(e){if(!t){return}var r=t.getHeaders();if(r){var n;var o=-1;for(n=0;n<r.length;n++){if(r[n].name=="Authorization"){o=n;break}}if(o!=-1){r.splice(o,1)}}if(e&&e!=""){t.addHeader("Authorization",e)}}function i(t){if(e.indexOf(t)==-1){e.push(t);return true}return false}return{addAppender:i,addDefaultAppenders:n,addESWebApiAppender:function(e){var r=e+"api/rpc/registerException/";t=new log4javascript.AjaxAppender(r,false);t.setSendAllOnUnload(true);t.setLayout(new log4javascript.JsonLayout);t.setWaitForResponse(true);t.setBatchSize(100);t.setTimed(true);t.setTimerInterval(6e4);t.addHeader("Content-Type","application/json");t.setFailCallback(function(e){console.error("Failed to POST Logs to the server",e)});return i(t)},$get:["$injector",function(i){try{var s=r();if(e.length==0){n()}var c=0;for(c=0;c<e.length;c++){s.addAppender(e[c])}console.info("ES Logger started");s.updateAjaxToken=o;s.sendAll=function(){try{if(t){t.sendAll()}}catch(e){}};return s}catch(a){console.log("Error in starting entersoft logger",a);return $log}}]}});e.provider("$exceptionHandler",function(){var e={pushToServer:false,logServer:""};return{getSettings:function(){return e},setPushToServer:function(t){e.pushToServer=t},setLogServer:function(t){e.logServer=t},$get:["$log","$window","es.Services.StackTrace","$injector",function(t,r,n,o){function i(i,s){var c,a,u;try{c=i.toString();a=n.print({e:i});u={errorUrl:r.location.href,errorMessage:c,stackTrace:a,cause:s||""};t.error(JSON.stringify(u,null,"	"))}catch(l){console.log(arguments)}if(e.pushToServer){try{var p=o.get("es.Services.WebApi");p.registerException(u,e.logServer)}catch(l){t.warn("ES Error in registerException on store "+e.logServer);t.log(l)}}}return i}]}})})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.Globals",["$sessionStorage","$log",function(e,t){function r(){if(!i.connectionModel){var r=e;var n=null;if(typeof r.__esrequest_sesssion!=="undefined"&&r.__esrequest_sesssion!==null){n=r.__esrequest_sesssion;i.connectionModel=n;t.info("RELOGIN User ",i.connectionModel.Name)}}return i.connectionModel}function n(r){i.connectionModel=r;if(!r){delete e.__esrequest_sesssion}else{e.__esrequest_sesssion=r}t.updateAjaxToken(o(r))}function o(e){if(e){return"Bearer "+e.WebApiToken}return""}var i={hostUrl:"",connectionModel:null,getWebApiToken:function(){return o(r())},setModel:n,getModel:r};return{getWebApiToken:function(){return i.getWebApiToken()},getClientSession:function(){return i},sessionClosed:function(){i.setModel(null)},sessionOpened:function(e){try{i.setModel(e.Model);t.info("LOGIN User ",e.Model.Name)}catch(r){t.log.error(r);throw r}}}}]);e.run(["$log","es.Services.Globals","es.Services.WebApi",function(e,t,r){e.updateAjaxToken(t.getWebApiToken());t.getClientSession().hostUrl=r.getServerUrl()}])})();