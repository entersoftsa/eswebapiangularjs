(function(){"use strict";var e=angular.module("es.Core.Filters",[]);e.filter("esTrustHtml",["$sce",function(e){return function(r){return e.trustAsHtml(r)}}])})();(function(){"use strict";var e=angular.module("es.Services.Web",["ngStorage","ngSanitize"]);e.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__USERSITES__:"api/Login/Usersites",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__REGISTER_EXCEPTION__:"api/rpc/registerException/"});e.value("__WEBAPI_RT__",{url:""});function r(e,r){return e.indexOf(r,e.length-r.length)!==-1}function t(e,r){return e.toLowerCase().indexOf(r.toLowerCase())===0}e.provider("es.Services.WebApi",function(){var e="";var n="";var o="";var i={host:"",allowUnsecureConnection:false,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return i},getServerUrl:function(){return e},setSettings:function(s){var a="https://";var c="http://";i=s;if(i.host){i.host=i.host.trim();if(t(i.host,a)){i.host=i.host.slice(a.length).trim()}else if(t(i.host,c)){i.host=i.host.slice(c.length).trim()}if(i.host==""){throw"host for Entersoft WEB API Server is not specified"}if(!r(i.host,"/")){i.host+="/"}n=c+i.host;o=a+i.host;if(i.allowUnsecureConnection){e=n}else{e=o}}else{throw"host for Entersoft WEB API Server is not specified"}return this},$get:["$http","$log","$q","$rootScope","ESWEBAPI_URL","es.Services.Globals",function(r,t,s,a,c,u){return{getServerUrl:function(){return e},openSession:function(n){return r({method:"post",url:e+c.__LOGIN__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:n}}).success(function(e){u.sessionOpened(e)}).error(function(e){u.sessionClosed();t.error(e)})},logout:function(){u.sessionClosed();t.info("LOGOUT User")},registerException:function(r,n){if(!r){return}var o=angular.copy(r);try{o.__SubscriptionID=i.subscriptionId;o.__ServerUrl=e;o.__EDate=new Date;$.ajax({type:"POST",url:e.concat(c.__REGISTER_EXCEPTION__),contentType:"application/json",headers:{Authorization:u.getWebApiToken()},data:JSON.stringify({exceptionData:o,exceptionStore:n},null,"	")})}catch(s){t.warn("Error logging failed");t.error(s)}},fetchServerCapabilities:function(){var e=s.defer();r.get(n+c.__SERVER_CAPABILITIES__).success(function(r){e.resolve(r)}).error(function(){r.get(o+c.__SERVER_CAPABILITIES__).success(function(r){e.resolve(r)}).error(function(r,t,n,o){e.reject([r,t,n,o])})});return e.promise},fetchSimpleScrollerRootTable:function(t,n,o){var i=e.concat(c.__SCROLLERROOTTABLE__,t,"/",n);return r({method:"get",headers:{Authorization:u.getWebApiToken()},url:i,data:o})},fetchUserSites:function(t){return r({method:"post",url:e+c.__USERSITES__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:t}})},executeNewEntityAction:function(t,n,o){var i=e.concat(c.__ENTITYACTION__,t,"/",o);return r({method:"post",headers:{Authorization:u.getWebApiToken()},url:i,data:n})},executeEntityActionByCode:function(t,n,o,i){var s=e.concat(c.__ENTITYACTION__,t,"/",n,"/",i);return r({method:"post",headers:{Authorization:u.getWebApiToken()},url:s,data:o})},executeEntityActionByGID:function(t,n,o,i){var s=e.concat(c.__ENTITYBYGIDACTION__,t,"/",n,"/",i);return r({method:"post",headers:{Authorization:u.getWebApiToken()},url:s,data:o})},fetchPublicQuery:function(t,n,o){var i=e.concat(c.__PUBLICQUERY__,t,"/",n);return r({method:"get",headers:{Authorization:u.getWebApiToken()},url:i,data:o})},eSearch:function(t,n,o){var i=e.concat(c.__ELASTICSEARCH__,t);return r({method:n,headers:{Authorization:u.getWebApiToken()},url:i,data:o})}}}]}});e.factory("es.Services.ElasticSearch",["es.Services.WebApi",function(e){return{searchIndex:function(r,t){var n=r+"/_search";return e.eSearch(n,"post",t)},searchIndexAndDocument:function(r,t,n){var o=r+"/"+t+"/_search";return e.eSearch(o,"post",n)},searchFree:e.eSearch}}])})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.StackTrace",function(){return{print:printStackTrace}});e.provider("$log",function(){var e=[];var r=null;function t(){return log4javascript.getLogger("esLogger")}function n(e){i(new log4javascript.BrowserConsoleAppender);var r=angular.isDefined(e)&&e;if(r){i(new log4javascript.PopUpAppender)}}function o(e){if(!r){return}var t=r.getHeaders();if(t){var n;var o=-1;for(n=0;n<t.length;n++){if(t[n].name=="Authorization"){o=n;break}}if(o!=-1){t.splice(o,1)}}if(e&&e!=""){r.addHeader("Authorization",e)}}function i(r){if(e.indexOf(r)==-1){e.push(r);return true}return false}return{addAppender:i,addDefaultAppenders:n,addESWebApiAppender:function(e){var t=e+"api/rpc/registerException/";r=new log4javascript.AjaxAppender(t,false);r.setSendAllOnUnload(true);r.setLayout(new log4javascript.JsonLayout);r.setWaitForResponse(true);r.setBatchSize(100);r.setTimed(true);r.setTimerInterval(6e4);r.addHeader("Content-Type","application/json");r.setRequestSuccessCallback(function(e){console.log("ES Logger, BATCH of logs upoloaded",e.responseURL,e.status)});r.setFailCallback(function(e){console.error("Failed to POST Logs to the server",e)});return i(r)},$get:["es.Services.Messaging",function(i){try{var s=t();if(e.length==0){n(true)}var a=0;for(a=0;a<e.length;a++){s.addAppender(e[a])}console.info("ES Logger started");i.subscribe("AUTH_CHANGED",function(e,r){o(r)});s.sendAll=function(){try{if(r){r.sendAll()}}catch(e){}};return s}catch(c){console.log("Error in starting entersoft logger",c);return $log}}]}});e.provider("$exceptionHandler",function(){var e={pushToServer:false,logServer:""};return{getSettings:function(){return e},setPushToServer:function(r){e.pushToServer=r},setLogServer:function(r){e.logServer=r},$get:["$log","$window","es.Services.StackTrace","$injector",function(r,t,n,o){function i(i,s){var a,c,u;try{a=i.toString();c=n.print({e:i});u={errorUrl:t.location.href,errorMessage:a,stackTrace:c,cause:s||""};r.error(JSON.stringify(u,null,"	"))}catch(l){console.log(arguments)}if(e.pushToServer){try{var f=o.get("es.Services.WebApi");f.registerException(u,e.logServer)}catch(l){r.warn("ES Error in registerException on store "+e.logServer);r.error(l)}}}return i}]}})})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.Messaging",function(){var e={};function r(){if(!arguments||arguments.Length<1){throw"Publishing events requires at least one argument for topic id"}var r=arguments[0];var t=Array.prototype.slice.call(arguments,1);e[r]&&angular.forEach(e[r],function(e){e.apply(null,t)})}function t(r,t){if(!e[r]){e[r]=[]}e[r].push(t);return[r,t]}function n(r){var t=r[0];e[t]&&angular.forEach(e[t],function(n){if(this==r[1]){e[t].splice(n,1)}})}var o={publish:r,subscribe:t,unsubscribe:n};return o});e.factory("es.Services.Globals",["$sessionStorage","$log","es.Services.Messaging",function(e,r,t){function n(){if(!s.connectionModel){var n=e;var o=null;if(typeof n.__esrequest_sesssion!=="undefined"&&n.__esrequest_sesssion!==null){o=n.__esrequest_sesssion;s.connectionModel=o;t.publish("AUTH_CHANGED",o,i(o));r.info("RELOGIN User ",s.connectionModel.Name)}else{t.publish("AUTH_CHANGED",null,i(null));r.info("NO RELOGIN from stored state")}}return s.connectionModel}function o(r){s.connectionModel=r;if(!r){delete e.__esrequest_sesssion}else{e.__esrequest_sesssion=r}t.publish("AUTH_CHANGED",r,i(r))}function i(e){if(e){return"Bearer "+e.WebApiToken}return""}var s={hostUrl:"",connectionModel:null,getWebApiToken:function(){return i(n())},setModel:o,getModel:n};return{getWebApiToken:function(){return s.getWebApiToken()},getClientSession:function(){return s},sessionClosed:function(){s.setModel(null)},sessionOpened:function(e){try{s.setModel(e.Model);r.info("LOGIN User ",e.Model.Name)}catch(t){r.error(t);throw t}}}}]);e.run(["es.Services.Globals","es.Services.WebApi",function(e,r){var t=e.getClientSession();t.getModel();t.hostUrl=r.getServerUrl()}])})();