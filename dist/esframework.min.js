(function(){"use strict";var e=angular.module("es.Core.Filters",[]);e.filter("esTrustHtml",["$sce",function(e){return function(r){return e.trustAsHtml(r)}}])})();(function(){"use strict";var e=angular.module("es.Services.Web",["ngStorage","ngSanitize"]);e.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__USERSITES__:"api/Login/Usersites",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__REGISTER_EXCEPTION__:"api/rpc/registerException/"});e.value("__WEBAPI_RT__",{url:""});function r(e,r){return e.indexOf(r,e.length-r.length)!==-1}function t(e,r){return e.toLowerCase().indexOf(r.toLowerCase())===0}function n(e){var r=false;if(typeof e.__esrequest_sesssion!=="undefined"&&e.__esrequest_sesssion!==null){r=e.__esrequest_sesssion}if(r){return"Bearer "+r.WebApiToken}else{return""}}e.provider("es.Services.WebApi",function(){var e="";var o="";var s="";var i={host:"",allowUnsecureConnection:false,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return i},getServerUrl:function(){return e},setSettings:function(n){var a="https://";var c="http://";i=n;if(i.host){i.host=i.host.trim();if(t(i.host,a)){i.host=i.host.slice(a.length).trim()}else if(t(i.host,c)){i.host=i.host.slice(c.length).trim()}if(i.host==""){throw"host for Entersoft WEB API Server is not specified"}if(!r(i.host,"/")){i.host+="/"}o=c+i.host;s=a+i.host;if(i.allowUnsecureConnection){e=o}else{e=s}}else{throw"host for Entersoft WEB API Server is not specified"}return this},$get:["$http","$log","$sessionStorage","$q","ESWEBAPI_URL",function(r,t,a,c,u){return{openSession:function(t){delete a.__esrequest_sesssion;return r({method:"post",url:e+u.__LOGIN__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:t}})},getWebApiToken:function(){return n(a)},setUser:function(e){var r=e.Model;a.__esrequest_sesssion=r},getUser:function(){return a.__esrequest_sesssion||false},logout:function(){delete a.__esrequest_sesssion},registerException:function(r,o){if(!r){return}var s=angular.copy(r);try{s.__SubscriptionID=i.subscriptionId;s.__ServerUrl=e;s.__EDate=new Date;$.ajax({type:"POST",url:e.concat(u.__REGISTER_EXCEPTION__),contentType:"application/json",headers:{Authorization:n(a)},data:JSON.stringify({exceptionData:s,exceptionStore:o},null,"	")})}catch(c){t.warn("Error logging failed");t.log(c)}},fetchServerCapabilities:function(){var e=c.defer();r.get(o+u.__SERVER_CAPABILITIES__).success(function(r){e.resolve(r)}).error(function(){r.get(s+u.__SERVER_CAPABILITIES__).success(function(r){e.resolve(r)}).error(function(r,t,n,o){e.reject([r,t,n,o])})});return e.promise},fetchSimpleScrollerRootTable:function(t,o,s){var i=e.concat(u.__SCROLLERROOTTABLE__,t,"/",o);return r({method:"get",headers:{Authorization:n(a)},url:i,data:s})},fetchUserSites:function(t){return r({method:"post",url:e+u.__USERSITES__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:t}})},executeNewEntityAction:function(t,o,s){var i=e.concat(u.__ENTITYACTION__,t,"/",s);return r({method:"post",headers:{Authorization:n(a)},url:i,data:o})},executeEntityActionByCode:function(t,o,s,i){var c=e.concat(u.__ENTITYACTION__,t,"/",o,"/",i);return r({method:"post",headers:{Authorization:n(a)},url:c,data:s})},executeEntityActionByGID:function(t,o,s,i){var c=e.concat(u.__ENTITYBYGIDACTION__,t,"/",o,"/",i);return r({method:"post",headers:{Authorization:n(a)},url:c,data:s})},fetchPublicQuery:function(t,o,s){var i=e.concat(u.__PUBLICQUERY__,t,"/",o);return r({method:"get",headers:{Authorization:n(a)},url:i,data:s})},eSearch:function(t,o,s){var i=e.concat(u.__ELASTICSEARCH__,t);return r({method:o,headers:{Authorization:n(a)},url:i,data:s})}}}]}});e.factory("es.Services.ElasticSearch",["es.Services.WebApi",function(e){return{searchIndex:function(r,t){var n=r+"/_search";return e.eSearch(n,"post",t)},searchIndexAndDocument:function(r,t,n){var o=r+"/"+t+"/_search";return e.eSearch(o,"post",n)},searchFree:e.eSearch}}])})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.StackTrace",function(){return{print:printStackTrace}});e.provider("$log",function(){var e=[];function r(){t(new log4javascript.BrowserConsoleAppender);t(new log4javascript.PopUpAppender)}function t(r){if(e.indexOf(r)==-1){e.push(r);return true}return false}return{addAppender:t,addDefaultAppenders:r,addESWebApiAppender:function(e){var r=e+"api/rpc/log/";var n=new log4javascript.AjaxAppender(r,false);n.setSendAllOnUnload(true);n.setWaitForResponse(true);n.setBatchSize(10);n.setTimed(true);n.setTimerInterval(3e4);n.addHeader("Content-Type","application/json");n.setFailCallback(function(e){console.error("Failed to POST Logs to the server",e)});return t(n)},$get:["$injector",function(t){try{var n=log4javascript.getDefaultLogger();if(e.length==0){r()}var o=0;for(o=0;o<e.length;o++){n.addAppender(e[o])}console.info("ES Logger started");return n}catch(s){console.log("Error in starting entersoft logger",s);return $log}}]}});e.provider("$exceptionHandler",function(){var e={pushToServer:false,logServer:""};return{getSettings:function(){return e},setPushToServer:function(r){e.pushToServer=r},setLogServer:function(r){e.logServer=r},$get:["$log","$window","es.Services.StackTrace","$injector",function(r,t,n,o){function s(s,i){var a,c,u;try{a=s.toString();c=n.print({e:s});u={errorUrl:t.location.href,errorMessage:a,stackTrace:c,cause:i||""};r.error(JSON.stringify(u,null,"	"))}catch(_){console.log(arguments)}if(e.pushToServer){try{var l=o.get("es.Services.WebApi");l.registerException(u,e.logServer)}catch(_){r.warn("ES Error in registerException on store "+e.logServer);r.log(_)}}}return s}]}})})();