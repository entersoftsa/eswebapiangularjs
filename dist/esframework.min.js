(function(){"use strict";var e=angular.module("es.Core.Filters",[]);e.filter("esTrustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}])})();(function(){"use strict";var e=angular.module("es.Services.Web",["ngStorage","ngSanitize"]);e.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__USERSITES__:"api/Login/Usersites",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/"});function t(e,t){return e.indexOf(t,e.length-t.length)!==-1}function r(e,t){return e.toLowerCase().indexOf(t.toLowerCase())===0}function s(e){var t=false;if(typeof e.__esrequest_sesssion!=="undefined"&&e.__esrequest_sesssion!==null){t=e.__esrequest_sesssion}if(t){return"Bearer "+t.WebApiToken}else{return""}}e.provider("es.Services.WebApi",function(){var e="";var n="";var o="";var i={host:"",allowUnsecureConnection:false,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return i},setSettings:function(s){var u="https://";var c="http://";i=s;if(i.host){i.host=i.host.trim();if(r(i.host,u)){i.host=i.host.slice(u.length).trim()}else if(r(i.host,c)){i.host=i.host.slice(c.length).trim()}if(i.host==""){throw"host for Entersoft WEB API Server is not specified"}if(!t(i.host,"/")){i.host+="/"}n=c+i.host;o=u+i.host;if(i.allowUnsecureConnection){e=n}else{e=o}}return this},$get:["$http","$log","$sessionStorage","$q","ESWEBAPI_URL",function(t,r,u,c,a){return{openSession:function(r){delete u.__esrequest_sesssion;return t({method:"post",url:e+a.__LOGIN__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:r}})},setUser:function(e){var t=e.Model;u.__esrequest_sesssion=t},getUser:function(){return u.__esrequest_sesssion||false},logout:function(){delete u.__esrequest_sesssion},fetchServerCapabilities:function(){var e=c.defer();t.get(n+a.__SERVER_CAPABILITIES__).success(function(t){e.resolve(t)}).error(function(){t.get(o+a.__SERVER_CAPABILITIES__).success(function(t){e.resolve(t)}).error(function(t,r,s,n){e.reject([t,r,s,n])})});return e.promise},fetchSimpleScrollerRootTable:function(r,n,o){var i=e.concat(a.__SCROLLERROOTTABLE__,r,"/",n);return t({method:"get",headers:{Authorization:s(u)},url:i,data:o})},fetchUserSites:function(r){return t({method:"post",url:e+a.__USERSITES__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:r}})},executeNewEntityAction:function(r,n,o){var i=e.concat(a.__ENTITYACTION__,r,"/",o);return t({method:"post",headers:{Authorization:s(u)},url:i,data:n})},executeEntityActionByCode:function(r,n,o,i){var c=e.concat(a.__ENTITYACTION__,r,"/",n,"/",i);return t({method:"post",headers:{Authorization:s(u)},url:c,data:o})},executeEntityActionByGID:function(r,n,o,i){var c=e.concat(a.__ENTITYBYGIDACTION__,r,"/",n,"/",i);return t({method:"post",headers:{Authorization:s(u)},url:c,data:o})},fetchPublicQuery:function(r,n,o){var i=e.concat(a.__PUBLICQUERY__,r,"/",n);return t({method:"get",headers:{Authorization:s(u)},url:i,data:o})},eSearch:function(r,n,o){var i=e.concat(a.__ELASTICSEARCH__,r);return t({method:n,headers:{Authorization:s(u)},url:i,data:o})}}}]}});e.factory("es.Services.ElasticSearch",["es.Services.WebApi",function(e){return{searchIndex:function(t,r){var s=t+"/_search";return e.eSearch(s,"post",r)},searchIndexAndDocument:function(t,r,s){var n=t+"/"+r+"/_search";return e.eSearch(n,"post",s)},searchFree:e.eSearch}}])})();