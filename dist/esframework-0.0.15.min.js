(function(){"use strict";var e=angular.module("es.Services.Web",["ngStorage","ngSanitize"]);e.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__USERSITES__:"api/Login/Usersites",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__ESLOG_MESSAGE__:"api/logMessage/"});e.value("__WEBAPI_RT__",{url:""});function t(e,t){return e.indexOf(t,e.length-t.length)!==-1}function r(e,t){return e.toLowerCase().indexOf(t.toLowerCase())===0}function n(e){var t=false;if(typeof e.__esrequest_sesssion!=="undefined"&&e.__esrequest_sesssion!==null){t=e.__esrequest_sesssion}if(t){return"Bearer "+t.WebApiToken}else{return""}}e.provider("es.Services.WebApi",function(){var e="";var s="";var o="";var i={host:"",allowUnsecureConnection:false,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return i},setSettings:function(n){var a="https://";var c="http://";i=n;if(i.host){i.host=i.host.trim();if(r(i.host,a)){i.host=i.host.slice(a.length).trim()}else if(r(i.host,c)){i.host=i.host.slice(c.length).trim()}if(i.host==""){throw"host for Entersoft WEB API Server is not specified"}if(!t(i.host,"/")){i.host+="/"}s=c+i.host;o=a+i.host;if(i.allowUnsecureConnection){e=s}else{e=o}}else{throw"host for Entersoft WEB API Server is not specified"}return this},$get:["$http","$log","$sessionStorage","$q","ESWEBAPI_URL",function(t,r,a,c,u){return{openSession:function(r){delete a.__esrequest_sesssion;return t({method:"post",url:e+u.__LOGIN__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:r}})},setUser:function(e){var t=e.Model;a.__esrequest_sesssion=t},getUser:function(){return a.__esrequest_sesssion||false},invalidateUser:function(){delete a.__esrequest_sesssion},logout:function(){delete a.__esrequest_sesssion},esLog:function(t){if(!t){return}var s=angular.copy(t);try{s.__SubscriptionID=i.subscriptionId;s.__ServerUrl=e;s.__EDate=new Date;$.ajax({type:"POST",url:e.concat(u.__ESLOG_MESSAGE__),contentType:"application/json",headers:{Authorization:n(a)},data:angular.toJson(s)})}catch(o){r.warn("Error logging failed");r.log(o)}},fetchServerCapabilities:function(){var e=c.defer();t.get(s+u.__SERVER_CAPABILITIES__).success(function(t){e.resolve(t)}).error(function(){t.get(o+u.__SERVER_CAPABILITIES__).success(function(t){e.resolve(t)}).error(function(t,r,n,s){e.reject([t,r,n,s])})});return e.promise},fetchSimpleScrollerRootTable:function(r,s,o){var i=e.concat(u.__SCROLLERROOTTABLE__,r,"/",s);return t({method:"get",headers:{Authorization:n(a)},url:i,data:o})},fetchUserSites:function(r){return t({method:"post",url:e+u.__USERSITES__,data:{SubscriptionID:i.subscriptionId,SubscriptionPassword:i.subscriptionPassword,Model:r}})},executeNewEntityAction:function(r,s,o){var i=e.concat(u.__ENTITYACTION__,r,"/",o);return t({method:"post",headers:{Authorization:n(a)},url:i,data:s})},executeEntityActionByCode:function(r,s,o,i){var c=e.concat(u.__ENTITYACTION__,r,"/",s,"/",i);return t({method:"post",headers:{Authorization:n(a)},url:c,data:o})},executeEntityActionByGID:function(r,s,o,i){var c=e.concat(u.__ENTITYBYGIDACTION__,r,"/",s,"/",i);return t({method:"post",headers:{Authorization:n(a)},url:c,data:o})},fetchPublicQuery:function(r,s,o){var i=e.concat(u.__PUBLICQUERY__,r,"/",s);return t({method:"get",headers:{Authorization:n(a)},url:i,data:o})},eSearch:function(r,s,o){var i=e.concat(u.__ELASTICSEARCH__,r);return t({method:s,headers:{Authorization:n(a)},url:i,data:o})}}}]}});e.factory("es.Services.ElasticSearch",["es.Services.WebApi",function(e){return{searchIndex:function(t,r){var n=t+"/_search";return e.eSearch(n,"post",r)},searchIndexAndDocument:function(t,r,n){var s=t+"/"+r+"/_search";return e.eSearch(s,"post",n)},searchFree:e.eSearch}}])})();(function(){"use strict";var e=angular.module("es.Services.Web");e.factory("es.Services.StackTrace",function(){return{print:printStackTrace}});e.provider("$exceptionHandler",{$get:["es.Services.logService",function(e){return e}]});e.factory("es.Services.logService",["$log","$window","es.Services.StackTrace","$injector",function(e,t,r,n){function s(s,o){e.error.apply(e,arguments);try{var i=s.toString();var a=r.print({e:s});var c=c||n.get("es.Services.WebApi");var u={errorUrl:t.location.href,errorMessage:i,stackTrace:a,cause:o||""};c.esLog(u);console.log(angular.toJson(u))}catch(_){e.warn("Error logging failed");e.log(_)}}return s}])})();(function(){"use strict";var e=angular.module("es.Core.Filters",[]);e.filter("esTrustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}])})();